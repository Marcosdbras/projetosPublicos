*************************************************************************************
=====================================================================================
  Este arquivo contém informações sobre as implementações/correções da BEMAFI32.DLL
=====================================================================================
*************************************************************************************

				*** versão 5.3.0.0 ***

Arquivo BemaFI32.ini
--------------------

O arquivo de configuração da DLL não precisa estar no diretório de sistema do Windows
(Windows\System ou Windows\System32). Ele pode ser distribuído, juntamente com a dll, 
no mesmo diretório da aplicação.

OBS: Caso o arquivo BemaFI32.ini não esteja, juntamente com a dll, o default de procura 
será o diretório de sistema do Windows.

Pacote JAVA atualizado
----------------------

Foram implementadas melhorias na classe JAVA de acesso às impressoras fiscais Bematech, 
através da BemaFI32.dll. Agora, existe um pacote chamado Bematech.jar, o qual contém 
todas as classes utilizadas para realizar as operações com a impressora. Basta adicionar 
no projeto Java o arquivo Bematech.jar e a seguinte linha de código à classe do projeto: 

import bemajava.*;

Log Diário
----------

Foi criada a chave "LogDiario" no arquivo BemaFI32.ini que possibilita a geração do 
arquivo "BemaFI32.log" diariamente, ou seja, a dll irá criar um arquivo 
BemaFI32-AAAAMMDD.log com as operações realizadas entre sua aplicação -> dll -> impressora, 
permitindo uma maior depuração de possíveis erros que possam ocorrer. Serão mantidos apenas 
os 7 últimos logs gerados, sendo os anteriores apagados - sempre logs semanais. 

OBS: Essa configuração só terá efeito se a chave Log também estiver habilitada (Log=1). 

CrLfVinculado e CrLfGerencial
-----------------------------

Criamos as chaves "CrLfVinculado" e "CrLfVinculado" no arquivo BemaFI32.ini que permite 
ativar ou desativar o envio dos caracteres LF+CR pela dll.

Se sua aplicação já envia estes caracteres, juntamente com as linhas do texto para o cupom 
não fiscal vincula ou relatório gerencial, estas chaves podem ficar desativadas no arquivo 
BemaFI32.ini (CrLfVinculado=0 e CrLfVinculado=0). Mas, se você deseja que a dll controle o 
envio destes caracteres automaticamente, estas chaves devem estar ativadas.

OBS: O envio destes caracteres para salto de linha, terá efeitos nas funções Bematech_FI_UsaComprovanteNaoFiscalVinculado e Bematech_FI_RelatorioGerencial.

TimeOutGerencial
----------------

É possível controlar o timeout de retorno da dll, quando é realizada a impressão do relatório 
gerencial nas impressoras fiscais modelo MP-20 FI II e MP-40 FI II. Estes modelos imprimem 
uma Leitura X (exigido por lei) antes do inicio da impressão do relatório gerencial. O valor 
default é 40 segundos, podendo ser configurado até 120 segundos.

Bematech_FI_EfetuaFormaPagamentoIndiceDescricaoForma
----------------------------------------------------

Função implementada para efetuar a forma de pagamento, através de seu índice, permitindo o 
envio de um texto adicional.

Exemplo:

iRet = Bematech_FI_EfetuaFormaPagamentoIndiceDescricaoForma( "02", "100,00", "Cheque com 
vencimento em 30/10/06")

Bematech_FI_AtivaDesativaCancelamentoCupom2HorasMFD
---------------------------------------------------

Função implementada para ativar ou desativar o cancelamento do cupom fiscal que é realizado 
pela impressora, automaticamente quando é impressa a redução Z, às 02:00 horas.

OBS: Se esta opção for desativada, a impressora não cancelará o cupom fiscal que se encontra 
aberto, quando a mesma for emitir a redução Z às 02:00 horas (caso esteja habilitada para 
emitir a redução Z automaticamente), permitindo que a aplicação encerre o cupom para 
posteriormente emitir a redução Z.

Esta função está disponível para a impressora fiscal térmica MP-2000 TH FI versão 01.03.03 e 
superior, ou MP-2100 TH FI. 

iRet = Bematech_FI_AtivaDesativaCancelamentoCupom2HorasMFD(0)

Parâmetro 1 ativa o cancelamento e 0 desativa.

Bematech_FI_VerificaCancelamentoCupom2HorasMFD
----------------------------------------------

Função implementada para verificar se o flag de cancelamento está habilitado ou não.

cFlag = " " 
iRet = Bematech_FI_VerificaCancelamentoCupom2HorasMFD(cFlag)

Se a variável cFlag for igual a "1", cancelamento habilitado. Se for igual a "0" cancelamento 
desabilitado.

Esta função está disponível para a impressora fiscal térmica MP-2000 TH FI versão 01.03.03 e 
superior, ou MP-2100 TH FI. 

Bematech_FI_NumeroSerieCriptografado
------------------------------------

Função implementada para retornar o número de série da impressora fiscal, já criptografado.

OBS: Para os modelos MP-25 FI, MP-50 FI, MP-2000 TH FI, MP-2100 TH FI e MP-6000 TH FI, a chave 
"Impressora" deve estar igual a 1 (Impressora=1) no arquivo de configuração BemaFI32.ini para 
que o número de série retornado seja de 20 caracteres para a criptografia. Caso esta chave 
esteja igual a 0 (Impressora=0), serão retornados apenas 15 caracteres para a criptografia.

Exemplo:

' para as impressoras MP-20 FI II / MP-40 FI II 
' (chave Impressora=0)
NumeroSerie = Space(15) 
iRet = Bematech_FI_NumeroSerieCriptografado(NumeroSerie)

ou

' para as impressoras MP-25 FI / MP-50 FI / MP-2000 TH FI / MP-2100 TH FI / MP-6000 TH FI 
' (chave Impressora=1) 
NumeroSerie = Space(20) 
iRet = Bematech_FI_NumeroSerieCriptografado(NumeroSerie) 

Bematech_FI_NumeroSerieDescriptografado
---------------------------------------

Função implementada para descriptografar o número de série, criptografado a partir da função
Bematech_FI_NumeroSerieCriptografado.

Exemplo:

NumeroSerieDescrip = Space(15) 
iRet = Bematech_FI_NumeroSerieDescriptografado(NumeroSerie, NumeroSerieDescrip)

ou

NumeroSerieDescrip = Space(20) 
iRet = Bematech_FI_NumeroSerieDescriptografado(NumeroSerie, NumeroSerieDescrip)

Onde, a variável NumeroSerie deve conter o número de série criptografado pela função Bematech_FI_NumeroSerieCriptografado.


				*** versão 5.3.1.0 ***

- Versão gerada após correção do erro de comunicação durante a leitura das formas de pagamento 
  usando o emulado.


				*** versão 5.3.4.0 ***

- Alterada a variável de envio de comandos para o Bematech Monitor de global para local.


				*** versão 5.3.5.0 ***

- Alterada a função Bematech_FI_VendaBruta para calcular a venda bruta lendo as informações 
  dos totalizadores parciais, quando os dados da ultima redução z estiverem zerados.

- Compatibilizada a função Bematech_FI_EfetuaFormaPagamentoImpAntiga e Bematech_FI_ReducaoZImpAntiga 
  com as impressoras convenio 85.


				*** versão 5.3.6.0 ***

- Implementado o fechamento e abertura da porta de comunicação quando ocorre erro ao enviar o 
  comando para a impressora.

- Melhorado o tratamento de timeout da redução z. Se for impressora Térmica desconsidera a 
  configuração do ini (TimeOutZ), fica aguardando enquanto a impressora estiver retornando busy.


				*** versão 5.3.7.0 ***

- Implementado o suporte a MP-2100 TH FI nas funções Bematech_FI_RelatorioSintegraMFD e 
- Bematech_FI_GeraRelatorioSintegraMFD.


				*** versão 5.3.8.0 ***

- Implementada a leitura múltipla de dados para melhorar o desempenho na utilização do Windows 
  Terminal Service.


				*** versão 5.4.0.0 ***

- Incluido suporte a impressora MP-3000 TH FI.
- Atualizada a função Bematech_FI_DadosSintegraMFD para suportar novo layout da leitura da 
  memória fiscal.
- Atualizada a função Bematech_FI_ModeloImpressora para suportar a MP-3000 TH FI.
- Atualizado o arquivo .inf do driver USB para reconhecer o novo  Vendor ID da Bematech atualizado 
  na MP-3000 TH FI.
- Corrigido o erro de comunicação na interface USB.



				*** versão 5.4.1.0 ***

- Incluido suporte ao emulador da impressora MP-3000 TH FI (Emul3000).
- Corrigido erro de comunicação, na função de redução Z, para plataforma Windows Terminal Server.



				*** versão 5.5.0.0 ***

- Incluido suporte a geração dos registro da portaria CAT-52 do estado de SP.



				*** versão 5.5.0.1 ***

- Correções na função Bematech_FI_LeituraXSerial.

				*** versão 5.6.0.0 ***

- Correções nas rotinas de geração da RFD.

				*** versão 5.6.1.0 ***

- Correções nas rotinas de geração da RFD.
- Correções nas rotinas de uso do Bematech Monitor.
- Suporte de geração da RFD para o emulador.

				*** versão 5.6.7.1 ***

- Correções nas rotinas de geração da RFD.
- Implementação do controle e geração do arquivo da portaria CAT-52 quando é realizada a redução z
  automática em todas as situações.

				*** versão 5.7.0.0 ***

- Correções nas rotinas de geração da RFD.
- Implementada a função Bematech_FI_GeraRegistrosCAT52MFD.
- Implementado no arquivo BemaFI32.ini as chaves "ForceWTSClient" e "RetriesWTSCmd" para utilização
  com o driver Bematech Monitor

				*** versão 5.8.0.0 ***

- Correções nas rotinas de geração da RFD.
- Implementada a função Bematech_FI_TotalIcmsCupom.
- Correções na função Bematech_FI_GeraRegistrosCAT52MFD quando usada em VB.
- Implementada a função Bematech_FI_GeraRegistrosCAT52MFDEx.
- Implementado os índices das funções Bematech_FI_GeraRegistrosCAT52MFD e Bematech_FI_TotalIcmsCupom
para o Bematech Monitor.

				*** versão 5.8.0.2 ***

- Correção de data na geração do arquivo rfd para as impressoras matriciais.
- Implementada o alias curto para a função Bematech_FI_GeraRegistrosCAT52MFD (Bema_FI_GeraRegCAT52MFD).

				*** versão 5.8.0.3 ***

- Implementado controle da CAT-52 para a impressora MP-20 FI II códigos 4008 e 4108.

				*** versão 5.8.0.4 ***

- Correção da rotina de download das impressoras MFD para geração do Ato Cotepe 17/04.


				*** versão 5.9.0.0 ***

- Implementada a compatibilização com as impressora fiscais modelo MP-7000 TH FI e IBM 4610-KN4.
- Implementada a função Bematech_FI_ViraChequeMFD específica para estes dois modelos.
- Implementada a Bematech_FI_AvancaPapelAcionaGuilhotinaMFD específica para estes dois modelos.
- Implementada a Bematech_FI_ImprimeChequeMFDEx específica para estes dois modelos.

				*** versão 5.9.0.1 ***

- Ajuste no time-out de download da MFD em impressoras térmicas, eliminando erros de comunicação,
no processo de geração do arquivo do Ato Cotepe 17/04 para a NF Paulista.

				*** versão 5.9.2.0 ***

- Implementado suporte a geração da CAT52 para as impressoras matricias Eagle (Printer 2000 e 
  Printer 2002).

				*** versão 5.9.3.0 ***

- Corrigido o erro de alíquota não programada quando utilizado o Bematech Monitor com a geração da
  CAT-52 desabilitada (UF=). Se a geração da CAT52 estivesse habilitada (UF=SP) o erro não ocorria.

- Corrigido o erro "Exception java.lang.UnsatisfiedLinkError: bemajava.Bematech.CGC_IE" durante a chamada da função CGC_IE no módulo java Bematech.jar.

				*** versão 5.9.7.0 ***

- Após a emissão de cupom fiscal as informações da impressora páram de ser retornadas no arquivo retorno.txt quando as chaves "Retorno" e "CalculoIcmsCupom" estão configuradas com o valor 1 no arquivo BemaFI32.ini.

- Ao configurar a chave "ForceWTSClient" com o valor 1 no arquivo BemaFI32.ini e executar qualquer comando, a dll gerava "Access Violation" no ambiente WTS (Windows Terminal Server).

- Compatibilizada a função "Bematech_FI_VendeItemDepartamento" para a impressora MP-7000 TH FI
- Impressora fiscal modelo MP-20 FI II código 4708 estava gerando o relatório da CAT-52 como impressora EAGLE.

				*** versão 5.10.0.0 ***

- Implementado o modelo MP-4000 TH FI.
- Implementadas as funções:
	- Bematech_FI_FlagsFiscais3MFD
	- Bematech_FI_VendeItemArredondamentoMFD
	- Bematech_FI_TotalIssCupomMFD
	- Bematech_FI_AbreSegundaViaNaoFiscalVinculadoMFD
	- Bematech_FI_AtivaDesativaGuilhotinaMFD
	- Bematech_FI_EstornoNaoFiscalVinculadoPosteriorMFD
- Criada a chave HabilitaRFDImpMFD que permite a geração do arquivo .rfd para os modelos de
  impressoras fiscais térmicas.

				*** versão 5.10.3.0 ***

- Foram atualizadas as seguintes funções:
	- Bematech_FI_GeraRegistrosCAT52MFDEx
	- Bematech_FI_TotalIcmsCupom
- Realiza correção na função Bematech_FI_RetornoAliquotas para quando existem alíquotas "00,00%"
  cadastradas na impressora.

				*** versão 5.10.4.3 ***
				
- Implementado Suporte a balanca Bematech SA-110.
- Foram atualizadas as seguintes funções:
	Bematech_FI_InfoBalanca
- Implementadas as funções:
	Bematech_FI_BaudRateBalanca
	Bematech_FI_DataHoraGravacaoUsuarioSWBasicoMFAdicional
- Implementado suporte RFD para todos os estados. Para gerar .RFD para incluir no .ini a entrada
  GerarRFD=0 na seção [Sistema].

				*** versão 5.10.4.4 ***
 
- Geração RFD independente por estado. Implementação para suportar CAT52 no estado Alagoas. 
- Suporte a balança Bematech 
- Função para retornar a data do último usuário, a data do último sw básico e mf adicional
  (Bematech_FI_DataHoraGravacaoUsuarioSWBasicoMFAdicional) 
 
				*** versão 5.10.4.5 ***
 
- Correção bug na função Bematech_FI_ModeloImpressora que não identificava corretamente a impressora
  4610 KN4 (IBM). 
 
				*** versão 5.10.4.6 ***
 
- Correção de bug na função Bematech_FI_DataHoraGravacaoUsuarioSWBasicoMFAdicional 
 
				*** versão 5.10.4.7 ***
 
- Compatibilidade da função Bematech_FI_DadosSintegraMFD para a impressora fiscal MP-4000 TH FI 

				*** versão 5.10.4.12 ***

- Implementado Alias com nomes curtos nas funções, para linguagens de programação que aceitam até 32
  caracteres no nome
- Compatibilidade da função Bematech_FI_DadosSintegraMFD na impressora fiscal MP-4000 TH FI
- Correção no retorno da função Bematech_FI_StatusEstendidoMFD para o pacote Bematech.jar (Java) 
- Implementada a leitura arquivo BemaFI32.ini também para o diretório local 
- Alteração na abertura da porta serial da balança (função Bematech_FI_InfoBalanca) sem controle de fluxo.

				*** versão 5.10.6.1 ***

- Implementada as seguintes funções para o PAF-ECF:

. Bematech_FI_AbreDocumentoAuxiliarVenda
. Bematech_FI_UsaDocumentoAuxiliarVenda
. Bematech_FI_FechaDocumentoAuxiliarVenda
. Bematech_FI_TerminaFechamentoCupomPreVenda
. Bematech_FI_DAVEmitidosRelatorioGerencial
. Bematech_FI_DAVEmitidosArquivo 
. Bematech_FI_LeituraMemoriaFiscalSerialDataPAFECF
. Bematech_FI_LeituraMemoriaFiscalSerialReducaoPAFECF
. Bematech_FI_EspelhoMFD
. Bematech_FI_ArquivoMFD
. Bematech_FI_IdentificacaoPAFECF
. Bematech_FI_GrandeTotalCriptografado
. Bematech_FI_GrandeTotalDescriptografado
. Bematech_FI_AbreRelatorioMeiosPagamento
. Bematech_FI_UsaRelatorioMeiosPagamento

- Implementado controle para a emissão do total de ICMS no cupom fiscal, conforme exigência da legislação do Cupom Mania do estado do RJ.

				*** versão 5.10.6.5 ***

- Funções modificadas:

. Bematech_FI_AbreDocumentoAuxiliarVenda
. Bematech_FI_DAVEmitidosRelatorioGerencial
. Bematech_FI_EspelhoMFD
. Bematech_FI_ArquivoMFD 
. Bematech_FI_IdentificacaoPAFECF 
. Bematech_FI_AbreRelatorioMeiosPagamaneto 
. Bematech_FI_UsaRelatorioMeiosPagamaneto 
. Bematech_FI_DataHoraGravacaoUsuarioSWBasicoMFAdicional

- Funções implementadas:

. Bematech_FI_FechaRelatorioMeiosPagamento 
. Bematech_FI_NomeiaRelatorioMeiosDePagamento 
. Bematech_FI_NomeiaRelatorioDocumentoAuxiliarDeVenda 
. Bematech_FI_NomeiaRelatorioDAVEmitidos 
. Bematech_FI_NomeiaRelatorioIdentificacaoPAFECF 
. Bematech_FI_NomeiaRelatoriosPAFECF